# S3 
**_Max Object size_** **5TB**
**_

**_S3 Encryption for Objects_**
**4 Methods**
- **SSE-S3**: Encrypts S3 using keys handled and managed by AWS 
- **SSE-KMS**: leverage AWS Key Management Service to manage encryption keys
- **SSE-C**: when you want to manage your own encryption keys 
- **Client Side Encrytpion**

**_SSE S3_** (_Server Side Encryption_)
- Object is encrypted server side 
- AES-256 type of encryption 
- Must Set header : "x-amz-server-side-encryption":"AES256"
```mermaid 
graph LR;
  A[Object]--Https+Header--> B{Object + S3 Managed Data Key}
  B--Encryption--> C[(Amazon S3 Bucket)]
```

**_SSE KMS_** (_Key Management Service_)
- Encryption using keys handled and managed by KMS
- KMS advantages: user control + audit trail
- Object is encrypted server side 
- Must set header: "x-amz-server-side-encryption":"aws:kms"
```mermaid 
graph LR;
  A[Object]--Https+Header--> B{Object + KMS Customer Master Key CMK}
  B--Encryption--> C[(Amazon S3 Bucket)]
```

**_SSE C_** 
- Server Side Encryption using data keys fully managed by the customer outside of AWS 
- Amazon S3 does not store the encryption keys you provide
- HTTPS must be used 
- Encryption Key must be provided in HTTP headers for every HTTP request made 

```mermaid 
graph LR;
  A[Object + Client Side Data Key]--Https Only + Data Key in Header--> B{Object + Client provided data Key}
  B--Encryption--> C[(Amazon S3 Bucket)]
```

**_Client Side Encryption_** 
- Client library such as Amazon S3 Encryption Client
- Client must encrypt data themselves before sending to S3
- Client must decrypt data themselves when retrieving from S3
- Customer fully manages the keys and encryption cycle 

```mermaid 
graph LR;
  A[Object + Client Side Data key] --Encryption-->B
  B--Https/-->C[(Amazon S3 Bucket)]
```

**_Encrption in Transit(SSL/TLS)_**
- Amazon S3 exposes 
  - HTTP Endpoint: non encrypted
  - HTTPS Endpoint: encryption in flight/SSLor TLS which relies on SSL and TLS certificates
  - You are free to use the endpoint you want but HTTPS is recommended
  - Most Clients will use HTTPS by default 
  - HTTPS is mandatory for SSE-C 
  
**_S3 Security_**
- User Based 
  - IAM Policies - which API calls should be allowed for a specific user from IAM console 
- Resource Based 
  - Bucket Policies - bucket wide rules from the S3 console - allows cross account 
  - Object Access Control List (ACL) - finer grain 
  - Bucket Access Control List (ACL) - less common 
 ##### An IAM Principal can access an S3 object if 
 - The user IAM permissions allow it or the resource policy allows it and there is no expicity deny

**_S3 Bucket Policies_**
JSON Based policies 
```json 
{    
    "Version": "2022-02-07",
    "Statement": [
         {    
             "Sid": "PublicRead",
             "Effect": "Allow",
             "Principal":"*",
             "Action":[
                  "s3:GetObject",
                  ],
             "Resource":[
                 "arn:aws:s3:::exampleBucket/*"
                 ]
         }
         ]
}
```
